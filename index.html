<!DOCTYPE html> 
<html lang="en"> 
	<head> 
	<meta charset="utf-8" />
	<title>Vanderbilt CPM | parameterz.com</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<meta name="description" content="calculate the probability of developing a coarctation in the setting of a PDA">    
	<meta name="author" content="Dan Dyar, MA, RDCS">
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>        
	<style type="text/css">
        :invalid {
          border: 2px solid #ff0000;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
           -webkit-appearance: none;
            margin: 0;
        }
        </style>
</head> 
<body> 

<div data-role="page" id="cpmPage">

	<div data-role="header" data-position="inline">
	    <h1>Vanderbilt CPM</h1>
	</div><!-- /header -->

	<div data-role="content">	
	    <p class="intro">
                Estimate the risk of developing a coarctation of the aorta in neonates with a PDA.
            </p>
            <form method="" action="">
                <div data-role="fieldcontain">
                    <label for="ca">Carotid Artery:</label>
                    <input type="number" name="ca" id="ca" class="cpmInput" min="0" step="0.01" title='numbers only, up to two decimal places' />
                </div>
                <div data-role="fieldcontain">
                    <label for="dt">Distal Transverse Aorta:</label>
                    <input type="number" name="dt" id="dt" class="cpmInput" min="0" step="0.01" title='numbers only, up to two decimal places' />
                </div>
                <div data-role="fieldcontain">
                    <label for="ca_sc">Carotid Artery to Subclavian:</label>
                    <input type="number" name="ca_sc" id="ca_sc" class="cpmInput" min="0" step="0.01" title='numbers only, up to two decimal places' />
                </div>
                <div data-role="fieldcontain">
                    <label for="isthmus">Isthmus:</label>
                    <input type="number" name="isthmus" id="isthmus" class="cpmInput" min="0" step="0.01" title='numbers only, up to two decimal places' />
                </div>
                <div data-role="fieldcontain">
                    <label for="dao">Descending Aorta:</label>
                    <input type="number" name="dao" id="dao" class="cpmInput" min="0" step="0.01" title='numbers only, up to two decimal places' />
                </div>
                <div data-role="fieldcontain">
                    <input type="button" value="Update" />
                    <input type="reset" value="reset" />
                </div>
            </form>
            <hr />
            <div class="results">
                <h2>Results</h2>
                <h3>Probability: <span id="probability">---</span>&nbsp;<span id="interpretation"></span></h3>
                
                <table id="cpmTable">
                    <thead>
                        <tr>
                            <th scope="col">Ratio</th>
                            <th scope="col">Value</th>
                        </tr>
                    </thead>
                    <tr>
                        <td>Carotid Artery to Distal Transverse :</td>
                        <td id="ca_dt" class="ratio" ></td>
                    </tr>
                    <tr>
                        <td>Distal Transverse to Carotid-to-Subclavian :</td>
                        <td id="dt_ca_sc" class="ratio"></td>
                    </tr>
                    <tr>
                        <td>Isthmus to Descending Aorta :</td>
                        <td id="isthmus_dao" class="ratio"></td>
                    </tr>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div id="disclaimer">
                <p>Note: not intended as clinical/surgical referral advice. If you are basing medical treatment on a calculator you found
                free on the internet and things go horribly wrong&mdash; you have no one to blame but yourself.</p>
            </div>
	</div><!-- /content -->

	<div data-role="footer">
	    <a href="https://github.com/parameterz/vanderbilt-cpm" data-icon="star" rel="external">Source</a>    
	</div><!-- /footer -->
</div><!-- /page -->
<script type="text/javascript">
    //
    function makeInterpretation(val){
        if(val<0){
            $('#interpretation').text('');
        }
        if(val>0 && val <= 0.15){
            $('#interpretation').text('(Low)');
        }
        if(val>0.15 && val <=0.6){
            $('#interpretation').text('(Moderate)');
        }
        if(val>0.6){
            $('#interpretation').text('(High)');
        }
    }
    function calcAll(){
        var ca, dt, ca_sc, isthmus, dao, ratio1, ratio2, ratio3, probability;
        ca = parseFloat($('#ca').val());
        dt = parseFloat($('#dt').val());
        ca_sc = parseFloat($('#ca_sc').val());
        isthmus = parseFloat($('#isthmus').val());
        dao = parseFloat($('#dao').val());
        //do the ratioes
        if( !isNaN(ca) && !isNaN(dt) ){
            ratio1 = ca/dt;
            $('#ca_dt').text(ratio1.toFixed(3));
        } else {
            $('#ca_dt').text('---');
        }
        if( !isNaN(dt) && !isNaN(ca_sc) ){
            ratio2 = dt/ca_sc;
            $('#dt_ca_sc').text(ratio2.toFixed(3));
        } else {
            $('#dt_ca_sc').text('---');
        }
        if( !isNaN(isthmus) && !isNaN(dao) ){
            ratio3 = isthmus/dao;
            $('#isthmus_dao').text(ratio3.toFixed(3));
        } else {
            $('#isthmus_dao').text('---');
        }
        // calculate the main model/probability
        if( !isNaN(ratio1) && !isNaN(ratio2) && !isNaN(ratio3) ){
            probability = 1 + Math.exp( - (-2.02 + 12.5 * ratio1 - 9.8 * ratio3 - 0.601 * ratio2 ));
            probability = Math.pow(probability, -1);
            $('#probability').text( (100 * probability).toFixed(2) + '%');
            makeInterpretation(probability);
        } else {
            $('#probability').text('---');
            makeInterpretation(-1);
            
        }

    }
</script>
<script type="text/javascript">
	$( document ).delegate("#cpmPage", "pageinit", function() {
        	//initial calc run
        	calcAll();
        });
     	
     	//calculate when we change inputs
	$( '.cpmInput' ).bind( "change", function() {
            calcAll();
        });
        
        //and when reset
        $("input[type='reset']").bind("click", function() {
            $('#probability,.ratio').text('---');
	    $('#interpretation').text('');
        });
</script>


</body>
</html>
